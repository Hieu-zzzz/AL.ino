<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√©t khu√¥n m·∫∑t ƒë·ªÉ x√°c nh·∫≠n</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap');

        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --accent: #b08968;
            --accent-2: #c1a57b;
            --cream: #f7f1e3;
            --paper: #fffaf3;
            --ink: #3b3b3b;
            --line: #e7dcc7;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Be Vietnam Pro', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at 20% 10%, #faf5e4, #f3efe6), linear-gradient(180deg, #fffaf3 0%, #f6f2e9 100%);
            min-height: 100vh;
            padding: 24px;
        }

        .container {
            max-width: 980px;
            margin: 0 auto;
            background: var(--paper);
            border-radius: 16px;
            box-shadow: 0 12px 30px rgba(43, 30, 16, 0.08);
            border: 1px solid var(--line);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #fff;
            padding: 28px 30px;
            text-align: center;
            position: relative;
        }

        .admin-actions {
            position: absolute;
            right: 16px;
            top: 16px;
        }

        .admin-link {
            background: rgba(255,255,255,0.15);
            color: #fff;
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 13px;
            cursor: pointer;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-card {
            width: min(920px, 92vw);
            background: var(--paper);
            border: 1px solid var(--line);
            border-radius: 14px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            padding: 18px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .admin-table th, .admin-table td {
            border: 1px solid var(--line);
            padding: 8px 10px;
            background: #fffef9;
        }
        .admin-table th {
            background: #f3e9d6;
            text-align: left;
        }
        .admin-toolbar {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 8px 0 14px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .scanner-section {
            text-align: center;
            margin-bottom: 24px;
        }

        .camera-box {
            width: 100%;
            margin: 0 auto;
            max-width: 720px;
            aspect-ratio: 16 / 9;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(176, 137, 104, 0.35);
        }

        #video {
            width: 100%;
            height: 100%;
            border-radius: 14px;
            border: 2px solid var(--accent);
            display: none;
            object-fit: cover;
            background: #111412;
        }

        .camera-placeholder {
            position: absolute;
            inset: 0;
            border-radius: 14px;
            border: 2px dashed rgba(176, 137, 104, 0.6);
            background: radial-gradient(ellipse at center, rgba(193,165,123,0.15) 0%, rgba(255,255,255,0.05) 70%), #111412;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e9d8bf;
        }

        .camera-placeholder span {
            background: rgba(176,137,104,0.15);
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid rgba(176,137,104,0.45);
            font-weight: 600;
        }

        .controls {
            margin: 18px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--accent), var(--accent-2));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary {
            background: #8f9aa6;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin: 18px 0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status.info {
            background: #f5efe3;
            color: #6b4f2e;
            border: 1px solid #eadfcb;
        }

        .status.success {
            background: #e7f2e6;
            color: #1b5e20;
            border: 1px solid #cfe8d0;
        }

        .status.error {
            background: #fdecea;
            color: #8a3324;
            border: 1px solid #f6cfc7;
        }

        .customer-info {
            background: var(--cream);
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        .customer-info h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: #fffef9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        .info-label {
            font-weight: 600;
            color: #6b4f2e;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .info-value {
            color: var(--ink);
            font-size: 1.1rem;
        }

        .sample-section {
            background: #fbf3df;
            border: 1px solid #f0e2be;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .sample-section h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .qr-samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .qr-sample {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .qr-sample:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .qr-sample strong {
            color: #2196F3;
            display: block;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèµÔ∏è Ph√≤ng Massage Y H·ªçc C·ªï Truy·ªÅn</h1>
            <p>Nh·∫≠n di·ªán khu√¥n m·∫∑t ƒë·ªÉ ti·∫øp nh·∫≠n kh√°ch v√† qu·∫£n l√Ω li·ªáu tr√¨nh</p>
            <div class="admin-actions">
                <button id="openAdmin" class="admin-link" title="Qu·∫£n tr·ªã">Qu·∫£n tr·ªã</button>
            </div>
        </div>

        <div class="main-content">
            <div class="scanner-section">
                <div class="camera-box">
                    <video id="video" playsinline autoplay muted></video>
                    <div id="cameraPlaceholder" class="camera-placeholder"><span>Khung camera s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y</span></div>
                </div>
                
                <div class="controls">
                    <button id="startBtn" class="btn btn-primary">
                        üì∑ B·∫Øt ƒë·∫ßu qu√©t khu√¥n m·∫∑t
                    </button>
                    <button id="stopBtn" class="btn btn-secondary" disabled>
                        ‚èπÔ∏è D·ª´ng Camera
                    </button>
                    <button id="confirmFaceBtn" class="btn btn-primary" style="background:linear-gradient(45deg,#2563eb,#22c55e)">‚úÖ X√°c nh·∫≠n khu√¥n m·∫∑t</button>
                    <button id="testCamBtn" class="btn" style="background:#f1f5f9;color:#111827;border:1px solid #e5e7eb;">üõ† Ki·ªÉm tra camera</button>
                    <label style="display:flex;align-items:center;gap:8px;font-size:14px;color:#444;">
                        <input id="autoStart" type="checkbox"> T·ª± ƒë·ªông m·ªü camera
                    </label>
                </div>

                <div id="status" class="status info">
                    Nh·∫•n "B·∫Øt ƒë·∫ßu qu√©t khu√¥n m·∫∑t" ƒë·ªÉ m·ªü camera
                </div>
            </div>

            <div id="customerInfo" class="customer-info">
                <h3>üìã Th√¥ng Tin B·ªánh Nh√¢n</h3>
                <div id="infoContent" class="info-grid">
                    <!-- Th√¥ng tin kh√°ch h√†ng s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
            </div>

            <div id="registrationSection" class="customer-info" style="display:none;">
                <h3>üìù Ti·∫øp Nh·∫≠n B·ªánh Nh√¢n M·ªõi</h3>
                <form id="registrationForm">
                    <div class="info-grid">
                        <!-- ·∫®n m·ª•c M√£ b·ªánh nh√¢n: s·∫Ω t·ª± t·∫°o sau khi l∆∞u -->
                        <div class="info-item">
                            <div class="info-label">H·ªç v√† t√™n <span style="color:#d32f2f">*</span></div>
                            <input id="fullName" name="fullName" type="text" class="form-input" required>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Ng√†y sinh <span style="color:#d32f2f">*</span></div>
                            <input id="dob" name="dob" type="date" class="form-input" required>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Gi·ªõi t√≠nh <span style="color:#d32f2f">*</span></div>
                            <select id="gender" name="gender" class="form-input" required>
                                <option value="">-- Ch·ªçn --</option>
                                <option value="Nam">Nam</option>
                                <option value="N·ªØ">N·ªØ</option>
                                <option value="Kh√°c">Kh√°c</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <div class="info-label">S·ªë ƒëi·ªán tho·∫°i <span style="color:#d32f2f">*</span></div>
                            <input id="phone" name="phone" type="tel" class="form-input" required>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Email</div>
                            <input id="email" name="email" type="email" class="form-input">
                        </div>
                        <div class="info-item">
                            <div class="info-label">CCCD/CMND</div>
                            <input id="nationalId" name="nationalId" type="text" class="form-input">
                        </div>
                        <div class="info-item">
                            <div class="info-label">ƒê·ªãa ch·ªâ <span style="color:#d32f2f">*</span></div>
                            <input id="address" name="address" type="text" class="form-input" required>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Ngh·ªÅ nghi·ªáp</div>
                            <input id="occupation" name="occupation" type="text" class="form-input">
                        </div>
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <div class="info-label">Tri·ªáu ch·ª©ng ch√≠nh <span style="color:#d32f2f">*</span></div>
                            <textarea id="chiefComplaint" name="chiefComplaint" class="form-input" rows="3" required></textarea>
                        </div>
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <div class="info-label">Ti·ªÅn s·ª≠ b·ªánh</div>
                            <textarea id="medicalHistory" name="medicalHistory" class="form-input" rows="3"></textarea>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Th·ªÉ ch·∫•t (ƒê√¥ng y)</div>
                            <select id="constitution" name="constitution" class="form-input">
                                <option value="">-- Ch·ªçn --</option>
                                <option>Kh√≠ h∆∞</option>
                                <option>Huy·∫øt h∆∞</option>
                                <option>√Çm h∆∞</option>
                                <option>D∆∞∆°ng h∆∞</option>
                                <option>ƒê√†m th·∫•p</option>
                                <option>Kh√≠ u·∫•t</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <div class="info-label">M·∫°ch/L∆∞·ª°i</div>
                            <input id="pulseTongue" name="pulseTongue" type="text" class="form-input" placeholder="V√≠ d·ª•: M·∫°ch tr·∫ßm t·∫ø, l∆∞·ª°i nh·∫°t...">
                        </div>
                    </div>
                    <div class="controls" style="margin-top:20px;">
                        <button type="button" id="cancelRegistration" class="btn btn-secondary">H·ªßy</button>
                        <button type="button" id="savePatient" class="btn btn-primary">L∆∞u ti·∫øp nh·∫≠n</button>
                    </div>
                    <div id="formErrors" class="status error" style="display:none; margin-top:10px;"></div>
                </form>
            </div>

            <div class="sample-section">
                <h4>üí° H∆∞·ªõng d·∫´n ti·∫øp nh·∫≠n</h4>
                <p>1. B·∫≠t camera v√† gi·ªØ khu√¥n m·∫∑t r√µ trong khung</p>
                <p>2. H·ªá th·ªëng t·ª± nh·∫≠n di·ªán v√† m·ªü h·ªì s∆°/phi·∫øu ti·∫øp nh·∫≠n</p>
                <p>3. V·ªõi kh√°ch m·ªõi, ƒëi·ªÅn th√¥ng tin ƒë·ªÉ l∆∞u v√† qu·∫£n l√Ω li·ªáu tr√¨nh</p>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal" aria-hidden="true">
        <div class="modal-card">
            <div class="modal-header">
                <h3 style="color:var(--primary)">B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã</h3>
                <button id="closeAdmin" class="btn btn-secondary" style="padding:6px 10px">ƒê√≥ng</button>
            </div>
            <div id="adminLogin">
                <div class="status info">Nh·∫≠p m√£ PIN qu·∫£n tr·ªã ƒë·ªÉ truy c·∫≠p</div>
                <div style="display:flex;gap:10px;align-items:center;margin:8px 0;">
                    <input id="adminPinInput" type="password" class="form-input" placeholder="PIN qu·∫£n tr·ªã">
                    <button id="adminLoginBtn" class="btn btn-primary" style="padding:10px 14px;">ƒêƒÉng nh·∫≠p</button>
                </div>
            </div>
            <div id="adminPanel" style="display:none;">
                <div class="admin-toolbar">
                    <button id="exportBtn" class="btn btn-secondary">Xu·∫•t JSON</button>
                    <label class="btn btn-secondary" style="cursor:pointer;">
                        Nh·∫≠p JSON<input id="importFile" type="file" accept="application/json" style="display:none;">
                    </label>
                    <button id="changePinBtn" class="btn btn-secondary">ƒê·ªïi PIN</button>
                </div>
                <div style="overflow:auto;max-height:60vh;">
                    <table class="admin-table" id="patientsTable">
                        <thead>
                            <tr>
                                <th>M√£</th><th>H·ªç t√™n</th><th>ƒêi·ªán tho·∫°i</th><th>Email</th><th>ƒê·ªãa ch·ªâ</th><th>Lo·∫°i</th><th>Ti·ªÉu s·ª≠</th><th>Ghi ch√∫</th><th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let qrScanner = null;
        let isScanning = false;
        let scanHintTimeout = null;
        let scanFailTimeout = null;
        let faceScanInterval = null;
        let detectionHandled = false;
        let lastCapturedFaceHash = null;

        // D·ªØ li·ªáu m·∫´u ƒë√£ t·∫Øt ƒë·ªÉ b·∫£ng qu·∫£n tr·ªã tr·ªëng ban ƒë·∫ßu
        const customerDatabase = {};

        const video = document.getElementById('video');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const customerInfo = document.getElementById('customerInfo');
        const infoContent = document.getElementById('infoContent');
        const cameraPlaceholder = document.getElementById('cameraPlaceholder');
        const autoStart = document.getElementById('autoStart');
        const testCamBtn = document.getElementById('testCamBtn');
        const confirmFaceBtn = document.getElementById('confirmFaceBtn');

        // Canvas ·∫©n ƒë·ªÉ l·∫•y ·∫£nh t·ª´ video
        const hiddenCanvas = document.createElement('canvas');
        hiddenCanvas.width = 128;
        hiddenCanvas.height = 128;
        const registrationSection = document.getElementById('registrationSection');
        const registrationForm = document.getElementById('registrationForm');
        const formErrors = document.getElementById('formErrors');
        const cancelRegistration = document.getElementById('cancelRegistration');
        const regenIdBtn = document.getElementById('regenIdBtn');
        const savePatientBtn = document.getElementById('savePatient');
        const adminModal = document.getElementById('adminModal');
        const openAdmin = document.getElementById('openAdmin');
        const closeAdmin = document.getElementById('closeAdmin');
        const adminLogin = document.getElementById('adminLogin');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminPinInput = document.getElementById('adminPinInput');
        const exportBtn = document.getElementById('exportBtn');
        const importFile = document.getElementById('importFile');
        const changePinBtn = document.getElementById('changePinBtn');
        const patientsTable = document.getElementById('patientsTable').querySelector('tbody');

        // Kh·ªüi t·∫°o scanner
        async function initScanner() {
            try {
                qrScanner = new QrScanner(
                    video,
                    result => onScanSuccess(result.data),
                    {
                        onDecodeError: err => {
                            // B·ªè qua l·ªói gi·∫£i m√£ li√™n t·ª•c
                        },
                        highlightScanRegion: true,
                        highlightCodeOutline: true,
                        preferredCamera: 'user',
                        maxScansPerSecond: 10,
                        returnDetailedScanResult: true,
                    }
                );
            } catch (error) {
                console.error('L·ªói kh·ªüi t·∫°o scanner:', error);
                updateStatus('Kh√¥ng th·ªÉ kh·ªüi t·∫°o camera. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p camera.', 'error');
            }
        }

        // B·∫Øt ƒë·∫ßu qu√©t
        async function startScanning() {
            if (!qrScanner) {
                await initScanner();
            }

            try {
                // Fallback: m·ªü camera th·ªß c√¥ng ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã khung h√¨nh
                await ensureCameraFeed();
                await qrScanner.start();
                isScanning = true;
                video.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                startBtn.disabled = true;
                stopBtn.disabled = false;
                updateStatus('ƒêang qu√©t... Gi·ªØ khu√¥n m·∫∑t r√µ trong khung ƒë·ªÉ t·ª± nh·∫≠n di·ªán', 'info');
                detectionHandled = false;
                startAutoFaceDetection();
                // Thi·∫øt l·∫≠p g·ª£i √Ω khi ch∆∞a th·∫•y g√¨
                clearTimeout(scanHintTimeout);
                clearTimeout(scanFailTimeout);
                scanHintTimeout = setTimeout(() => {
                    if (isScanning) {
                        updateStatus('Ch∆∞a nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£. H√£y tƒÉng s√°ng, ƒë∆∞a g·∫ßn h∆°n ho·∫∑c gi·ªØ ·ªïn ƒë·ªãnh.', 'info');
                    }
                }, 6000);
                // H·ªßy qu√©t sau m·ªôt th·ªùi gian v√† chuy·ªÉn sang ti·∫øp nh·∫≠n th·ªß c√¥ng
                scanFailTimeout = setTimeout(() => {
                    if (isScanning && !detectionHandled) {
                        stopScanning();
                        updateStatus('Kh√¥ng qu√©t ƒë∆∞·ª£c m√£. Chuy·ªÉn sang ti·∫øp nh·∫≠n b·ªánh nh√¢n th·ªß c√¥ng.', 'error');
                        showRegistrationForm('');
                    }
                }, 15000);
            } catch (error) {
                console.error('L·ªói khi b·∫Øt ƒë·∫ßu qu√©t:', error);
                const message = error && error.name === 'NotAllowedError'
                    ? 'Tr√¨nh duy·ªát ƒë√£ ch·∫∑n quy·ªÅn camera. Vui l√≤ng cho ph√©p camera v√† t·∫£i l·∫°i trang.'
                    : 'Kh√¥ng th·ªÉ truy c·∫≠p camera. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p ho·∫∑c thi·∫øt b·ªã.';
                updateStatus(message, 'error');
            }
        }

        // D·ª´ng qu√©t
        function stopScanning() {
            if (qrScanner && isScanning) {
                qrScanner.stop();
                isScanning = false;
                video.style.display = 'none';
                cameraPlaceholder.style.display = 'flex';
                startBtn.disabled = false;
                stopBtn.disabled = true;
                updateStatus('ƒê√£ d·ª´ng qu√©t. Nh·∫•n "B·∫Øt ƒë·∫ßu qu√©t khu√¥n m·∫∑t" ƒë·ªÉ ti·∫øp t·ª•c.', 'info');
                clearTimeout(scanHintTimeout);
                clearTimeout(scanFailTimeout);
                stopAutoFaceDetection();
            }
        }

        // X·ª≠ l√Ω k·∫øt qu·∫£ qu√©t
        function onScanSuccess(decodedText) {
            console.log('K·∫øt qu·∫£ nh·∫≠n di·ªán:', decodedText);
            
            // D·ª´ng qu√©t t·∫°m th·ªùi
            if (qrScanner && isScanning) {
                qrScanner.stop();
                isScanning = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }

            displayCustomerInfo(decodedText);
            clearTimeout(scanHintTimeout);
            clearTimeout(scanFailTimeout);
            stopAutoFaceDetection();
        }

        // Hi·ªÉn th·ªã th√¥ng tin kh√°ch h√†ng
        function displayCustomerInfo(customerId) {
            const mergedDb = getMergedDatabase();
            const customer = mergedDb[customerId];
            
            if (customer) {
                updateStatus(`‚úÖ T√¨m th·∫•y th√¥ng tin kh√°ch h√†ng: ${customer.name}`, 'success');
                
                infoContent.innerHTML = `
                    <div class="info-item">
                        <div class="info-label">M√£ kh√°ch h√†ng</div>
                        <div class="info-value">${customerId}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">H·ªç v√† t√™n</div>
                        <div class="info-value">${customer.name}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">S·ªë ƒëi·ªán tho·∫°i</div>
                        <div class="info-value">${customer.phone}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Email</div>
                        <div class="info-value">${customer.email}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ƒê·ªãa ch·ªâ</div>
                        <div class="info-value">${customer.address}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Lo·∫°i th√†nh vi√™n</div>
                        <div class="info-value">
                            <span style="
                                padding: 4px 12px; 
                                border-radius: 15px; 
                                font-size: 0.9rem;
                                background: ${customer.memberType === 'VIP' ? '#28a745' : customer.memberType === 'Th∆∞·ªùng' ? '#17a2b8' : '#ffc107'};
                                color: ${customer.memberType === 'M·ªõi' ? '#000' : '#fff'};
                            ">
                                ${customer.memberType}
                            </span>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ng√†y tham gia</div>
                        <div class="info-value">${customer.joinDate}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">T·ªïng ƒë∆°n h√†ng</div>
                        <div class="info-value">${customer.totalOrders} ƒë∆°n</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">T·ªïng chi ti√™u</div>
                        <div class="info-value">${customer.totalSpent}</div>
                    </div>
                    <div class="info-item" style="grid-column: 1 / -1;">
                        <div class="info-label">Ghi ch√∫</div>
                        <div class="info-value">${customer.notes}</div>
                    </div>
                `;
                
                customerInfo.style.display = 'block';
                registrationSection.style.display = 'none';
                customerInfo.scrollIntoView({ behavior: 'smooth' });
            } else {
                const newId = generatePatientId();
                // ƒë·∫£m b·∫£o d·ª´ng qu√©t v√† m·ªü form ti·∫øp nh·∫≠n ngay
                if (isScanning) { stopScanning(); }
                customerInfo.style.display = 'none';
                showRegistrationForm(newId);
                updateStatus('‚ùå Ch∆∞a c√≥ h·ªì s∆°. Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ ti·∫øp nh·∫≠n.', 'error');
            }
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i
        function updateStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // (ƒê√£ b·ªè ph·∫ßn m√¥ ph·ªèng QR m·∫´u)

        // G·∫Øn s·ª± ki·ªán
        startBtn.addEventListener('click', startScanning);
        stopBtn.addEventListener('click', stopScanning);
        cancelRegistration.addEventListener('click', () => {
            registrationSection.style.display = 'none';
            formErrors.style.display = 'none';
            resetRegistrationForm();
        });
        // Submit form khi nh·∫•n L∆∞u ti·∫øp nh·∫≠n
        registrationForm.addEventListener('submit', onSubmitRegistration);
        savePatientBtn.addEventListener('click', () => {
            // ƒê·∫£m b·∫£o modal qu·∫£n tr·ªã ƒë√≥ng tr∆∞·ªõc khi submit
            if (typeof adminModal !== 'undefined' && adminModal) adminModal.style.display = 'none';
            if (registrationForm.checkValidity()) registrationForm.requestSubmit();
            else registrationForm.reportValidity();
        });
        confirmFaceBtn.addEventListener('click', onConfirmFace);
        if (regenIdBtn) {
            regenIdBtn.addEventListener('click', () => {
                const idInput = document.getElementById('patientId');
                if (idInput) idInput.value = generatePatientId();
            });
        }
        if (savePatientBtn) {
            // ƒê·∫£m b·∫£o b·∫•m n√∫t lu√¥n submit form k·ªÉ c·∫£ khi browser kh√¥ng t·ª± submit
            savePatientBtn.addEventListener('click', () => {
                if (registrationForm.checkValidity()) {
                    registrationForm.requestSubmit();
                } else {
                    registrationForm.reportValidity();
                }
            });
        }

        // ===== Admin modal events =====
        openAdmin.addEventListener('click', () => {
            adminModal.style.display = 'flex';
            adminLogin.style.display = 'block';
            adminPanel.style.display = 'none';
        });
        closeAdmin.addEventListener('click', () => adminModal.style.display = 'none');
        adminLoginBtn.addEventListener('click', tryAdminLogin);
        exportBtn.addEventListener('click', exportPatients);
        importFile.addEventListener('change', importPatients);
        changePinBtn.addEventListener('click', changeAdminPin);

        // Kh·ªüi t·∫°o khi t·∫£i trang
        window.addEventListener('load', () => {
            updateStatus('·ª®ng d·ª•ng ƒë√£ s·∫µn s√†ng! Nh·∫•n "B·∫Øt ƒë·∫ßu qu√©t khu√¥n m·∫∑t" ƒë·ªÉ b·∫Øt ƒë·∫ßu.', 'info');
            // Ki·ªÉm tra t√πy ch·ªçn auto-start (l∆∞u theo sessionStorage)
            const savedAuto = sessionStorage.getItem('autoStartCamera') === 'true';
            autoStart.checked = savedAuto;
            if (savedAuto) {
                setTimeout(() => startScanning(), 300);
            }
        });

        // D·ªçn d·∫πp khi ƒë√≥ng trang
        window.addEventListener('beforeunload', () => {
            if (qrScanner) {
                qrScanner.destroy();
            }
        });

        // L∆∞u l·ª±a ch·ªçn auto-start
        autoStart.addEventListener('change', () => {
            sessionStorage.setItem('autoStartCamera', autoStart.checked ? 'true' : 'false');
        });

        // ===== Fallback m·ªü camera th·ªß c√¥ng (getUserMedia) =====
        async function ensureCameraFeed() {
            if (video.srcObject) return;
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user' },
                    audio: false
                });
                video.srcObject = stream;
                await video.play();
            } catch (e) {
                console.warn('Fallback camera failed:', e);
            }
        }

        // N√∫t ki·ªÉm tra camera tr·ª±c ti·∫øp kh√¥ng qua QR
        testCamBtn.addEventListener('click', async () => {
            try {
                await ensureCameraFeed();
                video.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                updateStatus('ƒêang hi·ªÉn th·ªã camera th·ª≠ nghi·ªám. N·∫øu th·∫•y h√¨nh, nh·∫•n B·∫Øt ƒë·∫ßu qu√©t.', 'info');
            } catch (e) {
                updateStatus('Kh√¥ng th·ªÉ m·ªü camera ƒë·ªÉ ki·ªÉm tra. Vui l√≤ng ki·ªÉm tra quy·ªÅn.', 'error');
            }
        });

        // ===== X√ÅC NH·∫¨N KHU√îN M·∫∂T (ƒê∆°n gi·∫£n b·∫±ng hash h√¨nh) =====
        async function onConfirmFace() {
            try {
                await ensureCameraFeed();
                if (!video.srcObject) {
                    updateStatus('Kh√¥ng m·ªü ƒë∆∞·ª£c camera. Vui l√≤ng ki·ªÉm tra quy·ªÅn.', 'error');
                    return;
                }
                const hash = await computeFaceHashFromVideo();
                lastCapturedFaceHash = hash;
                const matchId = findMatchingPatientId(hash);
                if (matchId) {
                    updateStatus('‚úÖ ƒê√£ nh·∫≠n di·ªán b·ªánh nh√¢n hi·ªán c√≥.', 'success');
                    displayCustomerInfo(matchId);
                } else {
                    const newId = generatePatientId();
                    updateStatus('Khu√¥n m·∫∑t m·ªõi. Vui l√≤ng nh·∫≠p th√¥ng tin ti·∫øp nh·∫≠n.', 'info');
                    showRegistrationForm(newId);
                    // ƒë·∫£m b·∫£o n√∫t l∆∞u ho·∫°t ƒë·ªông
                    setTimeout(() => {
                        if (savePatientBtn) {
                            savePatientBtn.disabled = false;
                        }
                    }, 0);
                }
            } catch (e) {
                console.error(e);
                updateStatus('L·ªói khi x√°c nh·∫≠n khu√¥n m·∫∑t.', 'error');
            }
        }

        async function computeFaceHashFromVideo() {
            const ctx = hiddenCanvas.getContext('2d');
            ctx.drawImage(video, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
            // T·∫°o aHash 8x8
            const small = document.createElement('canvas');
            small.width = 8; small.height = 8;
            const sctx = small.getContext('2d');
            sctx.drawImage(hiddenCanvas, 0, 0, 8, 8);
            const img = sctx.getImageData(0, 0, 8, 8).data;
            const gray = [];
            for (let i = 0; i < img.length; i += 4) {
                const g = img[i] * 0.299 + img[i+1] * 0.587 + img[i+2] * 0.114;
                gray.push(g);
            }
            const avg = gray.reduce((a,b)=>a+b,0) / gray.length;
            let bits = '';
            for (let i = 0; i < gray.length; i++) bits += gray[i] > avg ? '1' : '0';
            return bits;
        }

        function hammingDistance(a, b) {
            const len = Math.min(a.length, b.length);
            let d = 0;
            for (let i = 0; i < len; i++) if (a[i] !== b[i]) d++;
            return d + Math.abs(a.length - b.length);
        }

        function loadFaceMap() {
            const raw = localStorage.getItem('faceMap');
            return raw ? JSON.parse(raw) : [];
        }

        function saveFaceMap(map) {
            localStorage.setItem('faceMap', JSON.stringify(map));
        }

        function findMatchingPatientId(hash) {
            const map = loadFaceMap();
            let best = { id: null, dist: Infinity };
            for (const entry of map) {
                const dist = hammingDistance(hash, entry.hash);
                if (dist < best.dist) best = { id: entry.patientId, dist };
            }
            // Ng∆∞·ª°ng ƒë∆°n gi·∫£n, c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh (tƒÉng l√™n ƒë·ªÉ d·ªÖ kh·ªõp h∆°n)
            return best.dist <= 16 ? best.id : null;
        }

        function attachFaceToPatient(patientId, hash) {
            if (!hash) return;
            const map = loadFaceMap();
            const exists = map.find(e => e.patientId === patientId);
            if (exists) {
                exists.hash = hash;
            } else {
                map.push({ patientId, hash });
            }
            saveFaceMap(map);
        }

        function generatePatientId() {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth()+1).padStart(2,'0');
            const day = String(d.getDate()).padStart(2,'0');
            const rnd = Math.random().toString(36).slice(2,6).toUpperCase();
            return `BN${y}${m}${day}-${rnd}`;
        }

        // ===== T·ª± ƒë·ªông nh·∫≠n di·ªán khu√¥n m·∫∑t khi ƒëang qu√©t =====
        function startAutoFaceDetection() {
            stopAutoFaceDetection();
            let newFaceSamples = 0;
            let consecutiveMatchCount = 0;
            faceScanInterval = setInterval(async () => {
                if (!isScanning || detectionHandled) return;
                try {
                    const hash = await computeFaceHashFromVideo();
                    if (!hash) return;
                    const map = loadFaceMap();
                    if (map.length === 0) {
                        // N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu khu√¥n m·∫∑t n√†o, chuy·ªÉn sang ti·∫øp nh·∫≠n nhanh h∆°n
                        newFaceSamples++;
                        if (newFaceSamples >= 3) {
                            detectionHandled = true;
                            lastCapturedFaceHash = hash;
                            const newId = generatePatientId();
                            stopScanning();
                            updateStatus('Khu√¥n m·∫∑t m·ªõi. M·ªùi nh·∫≠p th√¥ng tin ti·∫øp nh·∫≠n.', 'info');
                            showRegistrationForm(newId);
                        }
                    } else {
                        const matchId = findMatchingPatientId(hash);
                        if (matchId) {
                            consecutiveMatchCount++;
                            if (consecutiveMatchCount >= 2) {
                                detectionHandled = true;
                                lastCapturedFaceHash = hash;
                                updateStatus('‚úÖ ƒê√£ nh·∫≠n di·ªán b·ªánh nh√¢n.', 'success');
                                stopScanning();
                                displayCustomerInfo(matchId);
                            } else {
                                updateStatus('ƒêang x√°c nh·∫≠n khu√¥n m·∫∑t...', 'info');
                            }
                        } else {
                            consecutiveMatchCount = 0;
                            newFaceSamples++;
                            // Sau nhi·ªÅu m·∫´u kh√¥ng match, m·ªü form ti·∫øp nh·∫≠n t·ª± ƒë·ªông
                            if (newFaceSamples >= 8) {
                                detectionHandled = true;
                                lastCapturedFaceHash = hash;
                                const newId = generatePatientId();
                                stopScanning();
                                updateStatus('Khu√¥n m·∫∑t m·ªõi. M·ªùi nh·∫≠p th√¥ng tin ti·∫øp nh·∫≠n.', 'info');
                                showRegistrationForm(newId);
                            }
                        }
                    }
                } catch (e) {
                    // B·ªè qua l·ªói t·∫°m
                }
            }, 900);
        }

        function stopAutoFaceDetection() {
            if (faceScanInterval) {
                clearInterval(faceScanInterval);
                faceScanInterval = null;
            }
        }

        // ====== B·ªî SUNG: Qu·∫£n l√Ω d·ªØ li·ªáu b·ªánh nh√¢n m·ªõi (localStorage) ======
        function getMergedDatabase() {
            const localDbRaw = localStorage.getItem('patients');
            const localDb = localDbRaw ? JSON.parse(localDbRaw) : {};
            return { ...customerDatabase, ...localDb };
        }

        function showRegistrationForm(patientId) {
            const patientIdInput = document.getElementById('patientId');
            if (patientIdInput) {
                patientIdInput.value = patientId || '';
            }
            // ƒê√≥ng b·∫£ng Qu·∫£n tr·ªã n·∫øu ƒëang m·ªü ƒë·ªÉ tr√°nh ch·∫∑n thao t√°c l∆∞u
            if (typeof adminModal !== 'undefined' && adminModal && adminModal.style.display === 'flex') {
                adminModal.style.display = 'none';
            }
            registrationSection.style.display = 'block';
            registrationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // focus v√†o tr∆∞·ªùng ƒë·∫ßu ti√™n ƒë·ªÉ nh·∫≠p nhanh
            setTimeout(() => {
                const first = document.getElementById('fullName');
                if (first) { first.focus(); }
            }, 200);
        }

        function onSubmitRegistration(event) {
            event.preventDefault();
            if (savePatientBtn) savePatientBtn.disabled = true;
            formErrors.style.display = 'none';
            formErrors.textContent = '';

            const data = {
                name: registrationForm.fullName.value.trim(),
                dob: registrationForm.dob.value,
                gender: registrationForm.gender.value,
                phone: registrationForm.phone.value.trim(),
                email: registrationForm.email.value.trim(),
                nationalId: registrationForm.nationalId.value.trim(),
                address: registrationForm.address.value.trim(),
                occupation: registrationForm.occupation.value.trim(),
                chiefComplaint: registrationForm.chiefComplaint.value.trim(),
                medicalHistory: registrationForm.medicalHistory.value.trim(),
                constitution: registrationForm.constitution.value,
                pulseTongue: registrationForm.pulseTongue.value.trim(),
                memberType: 'M·ªõi',
                joinDate: new Date().toLocaleDateString('vi-VN'),
                totalOrders: 0,
                totalSpent: '0 VNƒê',
                notes: 'Ti·∫øp nh·∫≠n m·ªõi qua qu√©t khu√¥n m·∫∑t'
            };

            const requiredErrors = [];
            if (!data.name) requiredErrors.push('H·ªç v√† t√™n l√† b·∫Øt bu·ªôc.');
            if (!data.dob) requiredErrors.push('Ng√†y sinh l√† b·∫Øt bu·ªôc.');
            if (!data.gender) requiredErrors.push('Gi·ªõi t√≠nh l√† b·∫Øt bu·ªôc.');
            if (!data.phone) requiredErrors.push('S·ªë ƒëi·ªán tho·∫°i l√† b·∫Øt bu·ªôc.');
            if (!data.address) requiredErrors.push('ƒê·ªãa ch·ªâ l√† b·∫Øt bu·ªôc.');
            if (!data.chiefComplaint) requiredErrors.push('Tri·ªáu ch·ª©ng ch√≠nh l√† b·∫Øt bu·ªôc.');

            if (requiredErrors.length > 0) {
                formErrors.innerHTML = requiredErrors.map(e => `‚Ä¢ ${e}`).join('<br>');
                formErrors.style.display = 'block';
                if (savePatientBtn) savePatientBtn.disabled = false;
                return;
            }

            // L∆∞u v√†o localStorage
            // T·ª± t·∫°o m√£ b·ªánh nh√¢n khi l∆∞u
            const idInput = document.getElementById('patientId');
            const id = generatePatientId();
            const localDbRaw = localStorage.getItem('patients');
            const localDb = localDbRaw ? JSON.parse(localDbRaw) : {};
            localDb[id] = {
                ...data,
                email: data.email || '‚Äî',
                address: data.address,
            };
            localStorage.setItem('patients', JSON.stringify(localDb));

            updateStatus('‚úÖ L∆∞u th√¥ng tin b·ªánh nh√¢n th√†nh c√¥ng.', 'success');
            // ·∫®n form v√† tr·ªü v·ªÅ giao di·ªán ban ƒë·∫ßu
            registrationSection.style.display = 'none';
            customerInfo.style.display = 'none';
            // Reset tr·∫°ng th√°i n√∫t/qu√©t v√† UI
            try { stopScanning(); } catch {}
            startBtn.disabled = false;
            stopBtn.disabled = true;
            video.style.display = 'none';
            if (cameraPlaceholder) cameraPlaceholder.style.display = 'flex';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // Lu√¥n c·∫≠p nh·∫≠t b·∫£ng qu·∫£n tr·ªã sau khi l∆∞u
            loadPatientsIntoTable();
            if (savePatientBtn) savePatientBtn.disabled = false;
            // G·∫Øn khu√¥n m·∫∑t ƒë√£ ch·ª•p v√†o h·ªì s∆° (n·∫øu c√≥)
            if (lastCapturedFaceHash) {
                attachFaceToPatient(id, lastCapturedFaceHash);
            }
        }

        // D·ªçn form sau khi l∆∞u/h·ªßy ƒë·ªÉ ch·ªâ hi·ªán l·∫°i khi c√≥ l·∫ßn qu√©t m·ªõi
        function resetRegistrationForm() {
            formErrors.textContent = '';
            formErrors.style.display = 'none';
            if (registrationForm) {
                registrationForm.reset();
            }
            const constitutionSelect = document.getElementById('constitution');
            if (constitutionSelect) constitutionSelect.value = '';
            lastCapturedFaceHash = null;
        }

        // ====== ADMIN ======
        const ADMIN_PIN_KEY = 'admin_pin_v1';
        function getAdminPin() {
            let pin = localStorage.getItem(ADMIN_PIN_KEY);
            // L·∫ßn ƒë·∫ßu ch∆∞a c√≥ PIN ‚Üí b·∫Øt ƒë·∫∑t PIN m·ªõi
            return pin || '';
        }
        function tryAdminLogin() {
            const stored = getAdminPin();
            if (!stored) {
                const first = prompt('Thi·∫øt l·∫≠p PIN qu·∫£n tr·ªã (4-8 k√Ω t·ª±):');
                if (!first || first.length < 4 || first.length > 8) {
                    updateStatus('PIN kh√¥ng h·ª£p l·ªá.', 'error');
                    return;
                }
                localStorage.setItem(ADMIN_PIN_KEY, first);
                adminLogin.style.display = 'none';
                adminPanel.style.display = 'block';
                loadPatientsIntoTable();
                return;
            }
            const pin = adminPinInput.value.trim();
            if (pin && pin === stored) {
                adminLogin.style.display = 'none';
                adminPanel.style.display = 'block';
                loadPatientsIntoTable();
            } else {
                updateStatus('Sai PIN qu·∫£n tr·ªã.', 'error');
            }
        }
        function loadPatientsIntoTable() {
            patientsTable.innerHTML = '';
            const merged = getMergedDatabase();
            Object.entries(merged).forEach(([id, p]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${id}</td>
                    <td contenteditable="true">${p.name || ''}</td>
                    <td contenteditable="true">${p.phone || ''}</td>
                    <td contenteditable="true">${p.email || ''}</td>
                    <td contenteditable="true">${p.address || ''}</td>
                    <td contenteditable="true">${p.memberType || ''}</td>
                    <td contenteditable="true">${p.medicalHistory || ''}</td>
                    <td contenteditable="true">${p.notes || ''}</td>
                    <td>
                        <button class="btn btn-primary" style="padding:6px 10px" data-act="save" data-id="${id}">L∆∞u</button>
                        <button class="btn btn-secondary" style="padding:6px 10px" data-act="delete" data-id="${id}">X√≥a</button>
                    </td>`;
                patientsTable.appendChild(tr);
            });
            patientsTable.querySelectorAll('button').forEach(btn => btn.addEventListener('click', onAdminRowAction));
        }
        function onAdminRowAction(e) {
            const btn = e.currentTarget;
            const id = btn.getAttribute('data-id');
            const tr = btn.closest('tr');
            if (btn.getAttribute('data-act') === 'save') {
                const tds = tr.querySelectorAll('td');
                const data = {
                    name: tds[1].textContent.trim(),
                    phone: tds[2].textContent.trim(),
                    email: tds[3].textContent.trim(),
                    address: tds[4].textContent.trim(),
                    memberType: tds[5].textContent.trim(),
                    medicalHistory: tds[6].textContent.trim(),
                    notes: tds[7].textContent.trim(),
                };
                // Save to local patients (override only local copy)
                const localDb = JSON.parse(localStorage.getItem('patients') || '{}');
                localDb[id] = { ...(localDb[id] || {}), ...data };
                localStorage.setItem('patients', JSON.stringify(localDb));
                updateStatus('ƒê√£ l∆∞u thay ƒë·ªïi.', 'success');
            } else {
                // delete
                const localDb = JSON.parse(localStorage.getItem('patients') || '{}');
                delete localDb[id];
                localStorage.setItem('patients', JSON.stringify(localDb));
                // C≈©ng lo·∫°i b·ªè kh·ªèi faceMap n·∫øu c√≥
                const fm = loadFaceMap().filter(e => e.patientId !== id);
                saveFaceMap(fm);
                tr.remove();
                updateStatus('ƒê√£ x√≥a b·ªánh nh√¢n.', 'success');
            }
        }
        function exportPatients() {
            const data = {
                patients: JSON.parse(localStorage.getItem('patients') || '{}'),
                faceMap: loadFaceMap(),
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'backup_patients.json'; a.click();
            URL.revokeObjectURL(url);
        }
        function importPatients(ev) {
            const file = ev.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    const obj = JSON.parse(reader.result);
                    if (obj.patients) localStorage.setItem('patients', JSON.stringify(obj.patients));
                    if (obj.faceMap) saveFaceMap(obj.faceMap);
                    loadPatientsIntoTable();
                    updateStatus('Nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng.', 'success');
                } catch {
                    updateStatus('T·ªáp JSON kh√¥ng h·ª£p l·ªá.', 'error');
                }
            };
            reader.readAsText(file);
        }
        function changeAdminPin() {
            const current = prompt('Nh·∫≠p PIN hi·ªán t·∫°i');
            if (current !== getAdminPin()) return alert('PIN hi·ªán t·∫°i kh√¥ng ƒë√∫ng');
            const next = prompt('Nh·∫≠p PIN m·ªõi (4-8 k√Ω t·ª±)');
            if (!next || next.length < 4 || next.length > 8) return alert('PIN kh√¥ng h·ª£p l·ªá');
            localStorage.setItem(ADMIN_PIN_KEY, next);
            alert('ƒê·ªïi PIN th√†nh c√¥ng');
        }
    </script>
</body>
</html>
